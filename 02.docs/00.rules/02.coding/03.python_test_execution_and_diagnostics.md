# 03. Execução e Diagnóstico de Testes Python

## 1. Execução de Testes

- **Framework:** `pytest`
- **Comandos:**
    - **Executar todos os testes:**
      ```bash
      pytest
      ```
    - **Executar um arquivo específico:**
      ```bash
      pytest tests/module/test_specific.py
      ```
    - **Executar com cobertura de código (requer `pytest-cov`):**
      ```bash
      pytest --cov=src
      ```

## 2. Diagnóstico de Falhas Persistentes

Quando um teste falha consistentemente e as correções iniciais não surtem efeito, é necessário um processo de diagnóstico estruturado para evitar a perda de tempo e registrar o aprendizado.

### 2.1. Processo de Diagnóstico

1.  **Criação do Relatório:** Após 3 tentativas de correção sem sucesso, pause a depuração.
2.  **Localização:** Crie uma subpasta em `tests/test_diagnostics/` com o nome do cenário ou módulo (ex: `TestUserModel_20250715/`).
3.  **Arquivo de Diagnóstico:** Dentro da pasta, crie um arquivo `test_report.md`.

### 2.2. Template do Relatório de Diagnóstico

Use o seguinte template para o arquivo `test_report.md`:

```markdown
### Diagnóstico de Falha - [Nome do Cenário/Módulo]

**Data:** [YYYY-MM-DD]
**Responsável:** [Seu Nome]

#### 1. Descrição do Erro

- **Comportamento Observado:** Descreva o que aconteceu de errado.
- **Localização:** Caminho do arquivo, função e linha do erro.
- **Logs e Stack Trace:**
  ```
  (Cole o stack trace completo aqui)
  ```

#### 2. Tentativas de Correção

1.  **Tentativa 1:** Descrição da mudança e por que falhou.
2.  **Tentativa 2:** Descrição da mudança e por que falhou.
3.  **Tentativa 3:** Descrição da mudança e por que falhou.

#### 3. Hipótese da Causa Raiz

- Descreva sua principal suspeita para a causa do erro (ex: "A fixture do banco de dados não está limpando a tabela X entre os testes").

#### 4. Análise de Contradições

- A falha indica alguma contradição entre a documentação, o código e os cenários de teste? (ex: "O cenário espera um status 200, mas a documentação da API especifica 201 para criação").

#### 5. Plano de Ação

- **Próximos Passos:** Detalhe as ações para resolver a falha (ex: "1. Refatorar a fixture do banco. 2. Ajustar o cenário para esperar o status 201.").
```

### 2.3. Checklist de Aceitação do Teste

Antes de considerar um novo teste como concluído e fazer o merge, verifique:

- [ ] O cenário está documentado e claro.
- [ ] O teste é independente e idempotente.
- [ ] A ação principal está isolada (não mistura setup/assert).
- [ ] As validações (`assert`) são completas.
- [ ] A limpeza (`teardown`) é garantida pelo uso de fixtures.
- [ ] O código segue as convenções de nomenclatura e estilo.
