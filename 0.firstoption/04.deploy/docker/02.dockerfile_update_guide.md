# 2. Guia para Atualização Confiável do Dockerfile

Este guia detalha uma sequência de passos segura para modificar seu `Dockerfile`, adicionar comandos para instalar Python e sua biblioteca `resipaia`, e aplicar essas mudanças ao seu ambiente Docker sem perder configurações existentes (assumindo que dados persistentes estejam em volumes).

## 2.1. Localizar o Dockerfile Existente

Antes de qualquer modificação, você precisa encontrar o `Dockerfile` que está sendo usado para construir a imagem do seu contêiner n8n. Ele geralmente está localizado:

*   [ ] **2.1.1.** Na raiz do seu projeto.
*   [ ] **2.1.2.** Em um diretório dedicado a configurações Docker, como `04.deploy/docker/`.

Se você não tem certeza, procure por um arquivo chamado `Dockerfile` (sem extensão) ou `Dockerfile.dev`, `Dockerfile.prod` etc., na estrutura do seu projeto.

## 2.2. Fazer Backup do Dockerfile Atual

É crucial ter um backup do seu `Dockerfile` antes de fazer qualquer alteração. Isso permite que você reverta facilmente se algo der errado.

*   [ ] **2.2.1.** Crie uma cópia do seu `Dockerfile` existente. Por exemplo, renomeie-o para `Dockerfile.bak` ou `Dockerfile.original`.

## 2.3. Modificar o Dockerfile

Agora, você irá adicionar os comandos necessários ao seu `Dockerfile`. Os comandos devem ser inseridos em um local apropriado, geralmente após a definição do `WORKDIR` e antes de quaisquer comandos que iniciem o serviço principal (como `CMD` ou `ENTRYPOINT`).

*   [ ] **2.3.1.** Abra seu `Dockerfile` com um editor de texto.

*   [ ] **2.3.2.** Adicione os seguintes comandos. **Atenção:** O comando `COPY` assume que o arquivo `resipaia_1.0.0_2025_07_06_22_51.whl` está no mesmo diretório do seu `Dockerfile` durante o processo de build. Se não estiver, ajuste o caminho de origem (`dist/resipaia_1.0.0_2025_07_06_22_51.whl` se o `Dockerfile` estiver na raiz do projeto e o `.whl` em `dist/`).

    ```dockerfile
    # Exemplo de Dockerfile (adapte ao seu)
    FROM n8n/n8n

    WORKDIR /usr/src/app

    # Instalar Python e pip
    # Este passo é necessário se a imagem base do n8n não incluir Python e pip
    RUN apt update && apt install -y python3 python3-pip

    # Copiar o arquivo .whl para o container
    # Certifique-se de que o .whl está no contexto de build do Docker
    COPY resipaia_1.0.0_2025_07_06_22_51.whl /usr/local/

    # Instalar a biblioteca
    RUN pip3 install /usr/local/resipaia_1.0.0_2025_07_06_22_51.whl

    # ... (outras configurações existentes do seu Dockerfile)

    CMD [ "n8n" ]
    ```

    **Explicação dos Comandos Adicionados:**

    *   [ ] **2.3.2.1. `RUN apt update && apt install -y python3 python3-pip`**: Atualiza a lista de pacotes e instala Python 3 e pip 3. Este comando é para imagens baseadas em Debian/Ubuntu (como a maioria das imagens oficiais do n8n). Se sua imagem base for diferente (ex: Alpine, CentOS), o comando de instalação será diferente (ex: `apk add python3 py3-pip` para Alpine).

    *   [ ] **2.3.2.2. `COPY resipaia_1.0.0_2025_07_06_22_51.whl /usr/local/`**: Copia o arquivo `.whl` da sua máquina local (do contexto de build do Docker) para o diretório `/usr/local/` dentro do contêiner. O nome do arquivo `.whl` deve ser o nome exato gerado pela compilação.

    *   [ ] **2.3.2.3. `RUN pip3 install /usr/local/resipaia_1.0.0_2025_07_06_22_51.whl`**: Instala a biblioteca Python a partir do arquivo `.whl` copiado. Usamos `pip3` para garantir que a instalação seja feita para o Python 3.

## 2.4. Reconstruir a Imagem Docker

Após modificar o `Dockerfile`, você precisa reconstruir a imagem Docker. Navegue até o diretório onde seu `Dockerfile` está localizado no terminal e execute o comando de build:

*   [ ] **2.4.1.** Execute o comando de build (substitua `<nome_da_sua_imagem>` por um nome de sua escolha, ex: `n8n-custom`):
    ```bash
    docker build -t <nome_da_sua_imagem> .
    ```
    O `.` no final indica que o contexto de build é o diretório atual. Certifique-se de que o arquivo `.whl` esteja neste diretório ou ajuste o caminho no comando `COPY` do `Dockerfile`.

## 2.5. Recriar o Contêiner Docker

Seu contêiner atual ainda está rodando com a imagem antiga. Para usar a nova imagem, você precisa parar e remover o contêiner antigo e, em seguida, criar um novo contêiner a partir da imagem recém-construída.

*   [ ] **2.5.1.** Liste seus contêineres para encontrar o nome ou ID do seu contêiner n8n atual:
    ```bash
    docker ps
    ```

*   [ ] **2.5.2.** Pare o contêiner n8n atual:
    ```bash
    docker stop <nome_ou_id_do_container_n8n_antigo>
    ```

*   [ ] **2.5.3.** Remova o contêiner n8n antigo:
    ```bash
    docker rm <nome_ou_id_do_container_n8n_antigo>
    ```

*   [ ] **2.5.4.** Crie e inicie um novo contêiner a partir da sua nova imagem. Adapte o comando `docker run` com suas portas, volumes e variáveis de ambiente:
    ```bash
    docker run -d --name <nome_do_seu_novo_container_n8n> -p 5678:5678 -v n8n_data:/home/node/.n8n <nome_da_sua_imagem>
    ```
    **Importante:** Certifique-se de incluir todos os volumes (`-v`) e variáveis de ambiente (`-e`) que você usava no seu contêiner antigo para não perder dados ou configurações.

## 2.6. Verificar a Instalação

Após o novo contêiner estar em execução, você pode verificar se a biblioteca foi instalada corretamente.

*   [ ] **2.6.1.** Acesse o shell do contêiner e tente importar a biblioteca `resipaia`:
    ```bash
    docker exec -it <nome_do_seu_novo_container_n8n> bash
    python -c "import resipaia; print('resipaia importado com sucesso!')"
    ```
    Se a importação for bem-sucedida, a mensagem será exibida. Caso contrário, um erro de `ModuleNotFoundError` será retornado.

Este guia fornece um caminho seguro para atualizar seu ambiente Docker. Lembre-se de adaptar os nomes de arquivos, imagens e contêineres aos seus próprios.