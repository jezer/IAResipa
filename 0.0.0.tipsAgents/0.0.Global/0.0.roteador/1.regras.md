
# 4) Regras do **AgenteRoteador**

* **Entrada:** qualquer prompt do usuário.
* **Saída:**

  * (a) Encaminhar para **1 agente** quando o assunto for unívoco.
  * (b) **Dividir** o prompt e abrir **2+ tarefas** quando houver **múltiplos assuntos**.
  * (c) Devolver **rejeição estruturada** quando nenhum agente é compatível (sugerir criação via AgenteCreator).
* **Como decide:** `router_rules.yaml` + heurística + few-shot.

```yaml
routing:
  rules:
    - name: "match_por_keyword_e_intento"
      when:
        keywords_any: ["criar agente","novo agente","padrões de agente"]
      route_to: "agente_creator"
    - name: "qualidade_melhoria"
      when:
        keywords_any: ["melhorar agente","contradição","ajustar regra","métrica"]
      route_to: "agente_qualidade"
  split_criteria:
    - "Se prompt contém perguntas de DOMÍNIOS diferentes (ex: 'criar agente' + 'rodar avaliação') → split"
  fallback:
    - action: "rejeitar"
      message: "Nenhum agente atual cobre seu pedido. Deseja que o **AgenteCreator** proponha um novo?"
```



# 9) Exemplos práticos de roteamento

**Ex. A (único assunto):**

> “Quero **criar um agente** que só responda sobre políticas de reserva.”
> → Roteador → **AgenteCreator**

**Ex. B (split):**

> “Avalie se há **contradições entre agentes** e também **crie um novo agente** para pagamentos.”
> → Split:

* Parte 1 → **AgenteQualidade**
* Parte 2 → **AgenteCreator**

**Ex. C (nenhum cobre):**

> “Integre esse sistema com um CRM X via plugin interno (inexistente).”
> → Rejeita + sugere **AgenteCreator** para propor agente/integração.


### Mensagens de retorno quando um agente recusa

* Se um agente responder “fora do escopo”, o **AgenteRoteador**:

  1. **Lê o motivo**,
  2. **Atualiza** o `router_rules.yaml` com um novo exemplo/few‑shot,
  3. **Re‑roteia** automaticamente (sem pedir ao usuário novamente),
  4. **Loga** o incidente em `logs/routing/*.ndjson`.
