
# 5) Regras do **AgenteQualidade** (execução diária)

* **Quando:** 1x ao dia (cron) — e.g., `RRULE:FREQ=DAILY;BYHOUR=3;BYMINUTE=0;BYSECOND=0` (horário de São Paulo).
* **Fontes:** `logs/interactions/*.ndjson`, `logs/routing/*.ndjson`, `shared/*/proposals/`, `agents/**/agent.yaml`.
* **Tarefas:**

  1. **Auditar** contradições: buscar regras idênticas/em conflito entre agentes.
  2. **Clusterizar** prompts (k‑means ou semântico) para achar lacunas de escopo.
  3. **Extrair** KPIs por agente (taxa de rejeição, retriagens, tempo de resposta, NPS/like).
  4. **Gerar PRs automáticos** (patches) nos `agent.yaml`/`prompt.md`.
  5. **Rodar lint + checklists**; se falhar, marca `status=pending_review`.
  6. **Sugerir splits/merges** de agentes quando necessário.



# 10) Testes mínimos (por agente)

* **Smoke:** valida `agent.yaml` contra schema.
* **Rejeição:** um prompt fora de escopo deve retornar a mensagem padrão.
* **Roteamento (no Roteador):** 10 casos de `single/split/reject` com asserts.
* **Qualidade:** simular conflito entre dois agentes e verificar PR gerado.

---


### `quality_policies.yaml` (exemplo)

```yaml
conflict_detection:
  methods:
    - "hash_de_regra_por_texto_normalizado"
    - "similaridade_semantica > 0.88"
  actions:
    - "se duplicada → mover para agente 'dono' e referenciar nos demais"
    - "se contraditória → abrir issue + PR com proposta de resolução"
metrics:
  - "reject_rate"
  - "reroute_rate"
  - "avg_first_assignment_accuracy"
  - "time_to_resolution"
improvement_loop:
  - "gerar diffs"
  - "rodar scripts/lint_perfil.py"
  - "aplicar checklists"
  - "salvar relatórios em logs/quality/*.ndjson"
```

# 6) Schemas mínimos (JSON) para padronizar I/O

**Requisição de criação de agente**

```json
{
  "$schema": "https://example.com/schemas/agent_request.schema.json",
  "type": "object",
  "required": ["name","scope","deliverables"],
  "properties": {
    "name": {"type":"string"},
    "scope": {"type":"string"},
    "constraints": {"type":"array","items":{"type":"string"}},
    "deliverables": {"type":"array","items":{"type":"string"}},
    "related_agents": {"type":"array","items":{"type":"string"}}
  }
}
```

**Evento de roteamento (log)**

```json
{
  "ts": "2025-08-19T22:59:12-03:00",
  "user_id": "anon",
  "prompt": "<texto>",
  "router_decision": {
    "type": "single|split|reject",
    "targets": ["agente_creator"]
  },
  "reason": "keywords: criar agente"
}
```

# 7) Checklists de qualidade (executados pelo lint/checker)

**checklists/perfil.md**

* [ ] Objetivo em 1 frase clara.
* [ ] Escopo IN/OUT explícito.
* [ ] Política de rejeição presente e testada.
* [ ] Formato de saída padronizado.
* [ ] Sem sobreposição com agentes existentes (rodar comparador).

**checklists/regras.md**

* [ ] Regras atômicas, sem “E/OU” ambíguos.
* [ ] Cada regra tem “dono” único.
* [ ] Referências cruzadas resolvidas (link para agente dono).

**checklists/contradicoes.md**

* [ ] Similaridade > 0.88 entre regras? Tratar.
* [ ] Há regras opostas entre agentes? Propor mediação.
