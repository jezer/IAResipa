Perfeito üëç Segue um **documento bem estruturado em blocos por perfil**, cada bloco pensado para um p√∫blico espec√≠fico (gest√£o, t√©cnico, QA/testes e usu√°rios).

---

# Instru√ß√µes do Projeto ‚Äî Site de Agendamentos

## 1. Objetivos, Regras Principais e Fluxos

**Perfil:** Diretoria, gest√£o, partes interessadas (vis√£o geral)

### Objetivos

* Criar um site acess√≠vel via **celular** e **desktop** para **agendar** ou **entrar na lista de espera** dos seguintes recursos:

  * Quiosque 1, Quiosque 2, Quiosque 3, Quiosque Fam√≠lia
  * Quadra de Beach Tennis, Quadra de Futebol, Campo Sint√©tico
* Garantir **controle de regras de neg√≥cio**, evitando conflitos, excesso de reservas ou mau uso.
* Exigir **login com usu√°rio e senha** (Supabase Auth).

### Regras Principais

* **Capacidade**: cada recurso s√≥ permite 1 reserva por faixa de hor√°rio.
* **Janela de agendamento**:

  * Anteced√™ncia m√≠nima: 24h.
  * Anteced√™ncia m√°xima: 60 dias.
* **Dura√ß√£o padr√£o**: 2h (parametriz√°vel).
* **Limites de uso por usu√°rio**:

  * M√°ximo de 2 reservas ativas simult√¢neas (ex.: 1 quiosque + 1 quadra).
  * Cooldown para quiosques: n√£o pode reservar novamente por X dias ap√≥s √∫ltimo uso.
  * Se alugou quiosque dentro do cooldown, n√£o pode nem agendar nem entrar em lista de espera.
* **Cancelamento e no-show**:

  * Cancelar at√© 48h sem multa.
  * Entre 48h e 6h ‚Üí bloqueio de 7 dias para novos quiosques.
  * <6h ou n√£o comparecimento ‚Üí bloqueio de 30 dias.
* **Lista de espera**:

  * Permitida s√≥ se usu√°rio n√£o violar regras.
  * Prioridade: ordem de entrada + hist√≥rico.
  * Quando vaga abre ‚Üí notifica√ß√£o + 2h para confirmar.

### Fluxos Gerais

1. Usu√°rio entra ‚Üí login (Supabase).
2. Seleciona recurso ‚Üí data ‚Üí faixa dispon√≠vel.
3. Se livre ‚Üí pode agendar.
4. Se ocupado ‚Üí pode entrar em lista de espera.
5. Pode cancelar agendamento ou desistir da lista.
6. Logs de todas a√ß√µes gravados (auditoria LGPD).

---

## 2. Detalhes T√©cnicos (Tecnologias, Seguran√ßa, Banco de Dados, Codifica√ß√£o)

**Perfil:** Desenvolvedores, arquitetos t√©cnicos

### Tecnologias

* **Banco de dados e autentica√ß√£o:** Supabase (Postgres + Auth + RLS).
* **Interface:** Google Sites (embed de mini-app HTML/JS).
* **L√≥gica de neg√≥cio:** Fun√ß√µes SQL no Supabase + Edge Functions (se necess√°rio).
* **Suporte backend adicional:** Python (FastAPI, opcional).
* **Front-end:** HTML, CSS, JavaScript (com Supabase JS SDK).

### Seguran√ßa

* **Login obrigat√≥rio** via Supabase Auth.
* **RLS (Row Level Security)** ativo: cada usu√°rio s√≥ acessa seus pr√≥prios dados.
* **Transa√ß√µes no banco** para evitar conflitos em reservas.
* **Logs de a√ß√µes** (criar, cancelar, fila de espera).

### Banco de Dados (resumo)

* **user\_profile**: dados do usu√°rio.
* **resource**: recursos (quiosques, quadras).
* **biz\_settings**: par√¢metros de regras (ex.: cooldown, max dias).
* **booking**: agendamentos (chave composta: recurso + data + faixa).
* **waitlist**: lista de espera.
* **op\_log**: auditoria.

### Codifica√ß√£o

* **Front-end (JS)**:

  * Login/logout.
  * Tela de sele√ß√£o ‚Üí agendar/cancelar/entrar em espera.
  * Chamadas a fun√ß√µes RPC (`fn_try_create_booking`, `fn_try_join_waitlist`).
* **Fun√ß√µes SQL (RPC)**:

  * `fn_try_create_booking`: cria reserva respeitando regras.
  * `fn_try_join_waitlist`: adiciona usu√°rio √† fila.
* **Edge Functions / Python** (opcional): notifica√ß√µes, rotinas de promo√ß√£o na lista.

---

## 3. Detalhes para Testes (Cen√°rios, Tecnologias de QA)

**Perfil:** QA/Testadores

### Tecnologias para testes

* **Manuais:** checklist de casos no `tests/plan.md`.
* **Automatizados:**

  * Pytest (chamadas HTTP ou RPC Supabase).
  * Postman/Newman (cole√ß√µes de cen√°rios de API).
  * Cypress (para interface web).

### Cen√°rios Principais

1. **Agendamento com sucesso** (slot livre).
2. **Agendamento em conflito** (mesmo hor√°rio ocupado).
3. **Cooldown de quiosques** (reserva rejeitada).
4. **Limite de reservas ativas** (ultrapassa limite).
5. **Cancelamento no prazo** (sem bloqueio).
6. **Cancelamento tardio** (bloqueio aplicado).
7. **No-show** (bloqueio + ocorr√™ncia).
8. **Entrar em lista de espera** (usu√°rio apto).
9. **Promo√ß√£o da lista de espera** (vaga aberta).
10. **RLS**: usu√°rio n√£o consegue acessar dados de outro.
11. **Auditoria**: logs gravados ap√≥s cada a√ß√£o.

---

## 4. Interface e Usabilidade dos Usu√°rios

**Perfil:** Usu√°rio final (moradores, administradores de quiosque/quadra)

### Navega√ß√£o

* **Login simples**: e-mail + senha.
* **Menu principal**:

  * Reservar recurso
  * Minha lista de reservas
  * Lista de espera
  * Cancelar reserva / sair da fila

### Usabilidade

* **Mobile-first**: bot√µes grandes, interface clara.
* **Feedback imediato**: mensagens "Agendado com sucesso", "J√° existe conflito", etc.
* **Calend√°rio interativo**: escolher data e ver hor√°rios dispon√≠veis.
* **Indicadores visuais**:

  * Verde = livre
  * Vermelho = ocupado
  * Amarelo = em espera
* **Confirma√ß√£o de a√ß√µes**: sempre pedir confirma√ß√£o antes de cancelar.

### Acessibilidade

* Alto contraste nas cores.
* Suporte a teclado e leitores de tela.
* Textos claros e diretos.

---

üëâ Quer que eu j√° transforme isso em **quatro arquivos Markdown separados** (um por perfil: gest√£o, t√©cnico, QA, usu√°rio) dentro de uma pasta `docs/`? Assim j√° fica pronto para usar como base no reposit√≥rio.
